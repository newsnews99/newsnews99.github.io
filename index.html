<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Federation Sun 2025</title>
<link rel="icon" href="favicon.ico" type="image/x-icon" />
<link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Anton&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Oswald:wght@400&display=swap" rel="stylesheet">
<style>
html, body {
  margin: 0;
  font-family: 'Oswald', sans-serif;
  background: #1e1e1e;
  color: white;
  box-sizing: border-box;
  overflow-x: hidden;
}

/* Logo Banner (scrolls away) */
.header-banner {
  background: #1e1e1e;
  padding: 16px 0;
  text-align: center;
}
.header-banner img {
  height: 53px;
  width: auto;
}

/* Sticky Bar (sticks at top) */
.header-bar {
  background: #1e1e1e;
  box-shadow: 0 2px 4px rgba(0,0,0,0.4);
  position: sticky;
  top: 0;
  z-index: 999;
}
.header-bar-inner {
  display: flex;
  align-items: center;
  justify-content: space-between;
  max-width: 1248px;
  margin: 0 auto;
  padding: 8px 16px;
  gap: 16px;
}

/* Time/date */
.header-time {
  flex: 0 0 auto;
  font-family: 'Roboto', sans-serif;
  font-size: 16px;
  color: white;
}

/* Sun icon hidden initially */
.sun-link {
  display: none;
  align-items: center;
  justify-content: center;
}
.sun-link img {
  height: 16px;
  width: auto;
}

/* Ticker styling */
.ticker-inner {
  flex: 1 1 auto;
  overflow: hidden;
  border-left: 1px solid #444;
  border-right: 1px solid #444;
  height: 16px;
  display: flex;
  align-items: center;
}
.ticker-track {
  display: flex;
  flex-wrap: nowrap;
  white-space: nowrap;
  animation: ticker-scroll var(--ticker-duration) linear infinite;
}
@keyframes ticker-scroll {
  0% { transform: translateX(0); }
  100% { transform: translateX(calc(-1 * var(--ticker-distance))); }
}
.ticker-inner:hover .ticker-track {
  animation-play-state: paused;
}

/* Search styling */
.search-wrapper {
  display: flex;
  align-items: center;
}
.search-wrapper button {
  background: none;
  border: none;
  cursor: pointer;
  display: flex;
  align-items: center;
}
.search-wrapper img {
  height: 16px;
  width: 16px;
}
.search-wrapper form {
  display: flex;
  flex-basis: 0;
  opacity: 0;
  overflow: hidden;
  pointer-events: none;
  transition: flex-basis 0.3s ease, opacity 0.3s ease;
}
.search-wrapper form.active {
  flex-basis: 220px;
  opacity: 1;
  pointer-events: auto;
}
.search-wrapper input[type="text"] {
  flex: 1;
  height: 32px;
  padding: 4px 8px;
  font-size: 16px;
  border: none;
  border-radius: 4px;
  outline: none;
  background: #fff;
  color: #1e1e1e;
  box-sizing: border-box;
}
.search-wrapper button {
  background-image: url('australian_flag.png');
  background-size: cover;
  background-repeat: no-repeat;
  background-position: center;
  border: 1px solid white;
  border-radius: 4px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  height: 32px;
  padding: 0 12px;
  box-sizing: border-box;
  color: white;
  font-size: 16px;
  font-weight: bold;
  text-shadow:
    -1px -1px 0 #1e1e1e,
     1px -1px 0 #1e1e1e,
    -1px  1px 0 #1e1e1e,
     1px  1px 0 #1e1e1e;
}

/* Hide date on mobile */
@media (max-width: 768px) {
  .header-time {
    display: none;
  }
}

/* Show sun icon next to date on desktop when scrolled */
@media (min-width: 769px) {
  .sun-link {
    margin-right: 8px;
  }
}
</style>
</head>
<body>

<!-- Logo Banner -->
<div class="header-banner">
  <a href="/">
    <img src="fedsun_logo_hoz.png" alt="Federation Sun Logo">
  </a>
</div>

<!-- Sticky Header Bar -->
<div class="header-bar">
  <div class="header-bar-inner">
    <a href="/" class="sun-link">
      <img src="sun.png" alt="Sun Icon">
    </a>
    <div class="header-time">
      <span id="top-time-line">Loading date...</span>
    </div>
    <div class="ticker-inner">
      <div id="ticker-track" class="ticker-track">Loading headlines...</div>
    </div>
    <div class="search-wrapper">
      <button id="search-toggle" aria-label="Search">
        <img src="icon_search.png" alt="Search">
      </button>
      <form id="search-form">
        <input type="text" id="search-input" placeholder="Search…">
      </form>
    </div>
  </div>
</div>

<!-- Spacer so content does not jump -->
<div style="height:16px;"></div>

<!-- Search Results -->
<div class="container">
  <div id="search-container">
    <button id="search-close" aria-label="Close Search Results">✕</button>
    <div id="search-filters"></div>
    <div id="search-results"></div>
    <div id="search-pagination"></div>
  </div>
</div>

<!-- Main Content -->
<div class="main-headline-wrapper">
  <div class="main-headline-layout">
    <div class="main-headline-left">
      <div class="main-headline-img-wrapper">
        <img src="1st.jpg" alt="Main Headline" class="main-headline-img" />
      </div>
      <a href="#" class="main-headline-link">WEBSITE UNDER CONSTRUCTION</a>
      <div class="two-columns-below">
        <div class="column" id="latest-headlines"></div>
        <div class="column" id="more-headlines">
          <div id="poll-container"></div>
          <div id="more-headlines-list"></div>
        </div>
      </div>
    </div>
    <div class="right-column" id="right-column-1"></div>
  </div>
</div>

<hr class="footer-separator" />
<div class="footer-social">
  <div class="social-icons">
    <a href="https://gab.com/federationsun" target="_blank"><img src="icon_gab.png" alt="Gab"></a>
    <a href="https://www.facebook.com/people/Federation-Sun/61577319796033/" target="_blank"><img src="icon_facebook.png" alt="Facebook"></a>
    <a href="https://www.instagram.com/fedsun.news/" target="_blank"><img src="icon_instagram.png" alt="Instagram"></a>
    <a href="https://fedsun.news/feed.xml" target="_blank"><img src="icon_rss.png" alt="RSS"></a>
    <a href="https://t.me/federationsun" target="_blank"><img src="icon_telegram.png" alt="Telegram"></a>
    <a href="https://x.com/federationsun" target="_blank"><img src="icon_x.png" alt="X"></a>
    <a href="https://www.youtube.com/channel/UCe8DBHr28mOCBxtZuxzJ7_A" target="_blank"><img src="icon_youtube.png" alt="YouTube"></a>
  </div>
</div>
<footer>
  <div class="footer-wrapper">
    <div class="footer-content">
      <div class="footer-section left">
        <img src="australian_flag.png" alt="Australian Flag" />
        <p>
          The Federation Sun proudly honours the European Australians who built this nation—taming the land, founding our cities, and instilling the traditions and institutions of Western civilisation that shaped Australia. We stand firm in our heritage and look ahead with unity and purpose to secure a strong future for our people.
        </p>
      </div>
      <div class="footer-section center">
        <a href="https://fedsun.news">
          <img src="fedsun__logo_footer.png" alt="Federation Sun Logo" />
        </a>
        <p>
          Contact:<br />
          editor@fedsun.news
        </p>
        <p>The Federation Sun © 2025</p>
      </div>
      <div class="footer-section right">
        <h3>SEND NEWS TIPS</h3>
        <form action="https://formspree.io/f/meokpdkj" method="POST">
          <textarea name="tip" placeholder="Type your tip here..."></textarea>
          <input type="hidden" name="_redirect" value="https://fedsun.news/thanks.html" />
          <button type="submit" class="button-flag">Send tip</button>
        </form>
      </div>
    </div>
  </div>
</footer>
<script>
// Update date/time
function updateTime() {
  const now = new Date();
  const day = new Intl.DateTimeFormat('en-AU', {
    timeZone: 'Australia/Melbourne',
    weekday: 'short'
  }).format(now);
  const date = new Intl.DateTimeFormat('en-AU', {
    timeZone: 'Australia/Melbourne',
    day: '2-digit',
    month: 'short',
    year: 'numeric'
  }).format(now);
  const timeLine = document.getElementById('top-time-line');
  if (timeLine) {
    timeLine.textContent = `${day}, ${date}`;
  }
}
updateTime();
setInterval(updateTime, 60000);
</script>

<script>
// Ticker + Headlines
Promise.all([
  fetch('/data/headlines.json?' + new Date().getTime()).then(r => r.json()),
  fetch('/data/ticker_extra.json?' + new Date().getTime()).then(r => r.json())
])
.then(([headlines, extras]) => {
  const today = new Date();
  const recent = headlines
    .filter(item => {
      const d = new Date(item.date);
      return (today - d) / (1000 * 60 * 60 * 24) <= 7;
    })
    .sort((a, b) => new Date(b.date) - new Date(a.date));

  // Ticker
  const track = document.getElementById('ticker-track');
  track.innerHTML = '';
  function createTickerGroup(extras, headlines) {
    const grp = document.createElement('div');
    grp.className = 'ticker-group';
    extras.forEach(item => {
      const sep = document.createElement('div');
      sep.className = 'ticker-separator';
      const img = document.createElement('img');
      img.src = '/flag_au1.png';
      img.alt = 'AU Flag';
      sep.appendChild(img);
      grp.appendChild(sep);
      const span = document.createElement('span');
      span.textContent = item.text;
      span.className = 'ticker-extra';
      grp.appendChild(span);
    });
    headlines.forEach(item => {
      const sep = document.createElement('div');
      sep.className = 'ticker-separator';
      const img = document.createElement('img');
      img.src = '/flag_au1.png';
      img.alt = 'AU Flag';
      sep.appendChild(img);
      grp.appendChild(sep);
      const a = document.createElement('a');
      a.href = item.url;
      a.textContent = item.title;
      grp.appendChild(a);
    });
    return grp;
  }
  const group = createTickerGroup(extras, recent.slice(0,6));
  for(let i=0; i<5; i++) {
    track.appendChild(group.cloneNode(true));
  }
  const dist = track.scrollWidth / 2;
  const speedPxPerSec = 30;
  const durationSec = dist / speedPxPerSec;
  document.documentElement.style.setProperty('--ticker-distance', dist + 'px');
  document.documentElement.style.setProperty('--ticker-duration', durationSec + 's');

  // Columns
  const col1 = document.getElementById('latest-headlines');
  const col2 = document.getElementById('more-headlines-list');
  const col3 = document.getElementById('right-column-1');
  const col1Headlines = recent.slice(0,6);
  const col2Headlines = recent.slice(6,10);
  const col3Headlines = recent.slice(10);
  function formatDateAEST(dateStr) {
    const date = new Date(dateStr);
    const day = String(date.getDate()).padStart(2, '0');
    const month = String(date.getMonth() + 1).padStart(2, '0');
    const year = String(date.getFullYear()).slice(-2);
    return `${day}/${month}/${year}`;
  }
  function createHeadlineItem(item) {
    const wrapper = document.createElement('div');
    wrapper.className = 'headline-item';
    wrapper.style.display = 'flex';
    wrapper.style.gap = '10px';
    wrapper.style.alignItems = 'flex-start';
    const img = document.createElement('img');
    img.src = item.image;
    img.alt = item.title;
    img.style.width = '33%';
    img.style.aspectRatio = '16/9';
    img.style.objectFit = 'cover';
    img.style.flexShrink = '0';
    const content = document.createElement('div');
    content.style.flex = '1';
    content.style.textAlign = 'left';
    const link = document.createElement('a');
    link.href = item.url;
    link.textContent = item.title;
    link.style.color = 'white';
    link.style.display = 'block';
    link.style.marginBottom = '4px';
    const meta = document.createElement('div');
    meta.className = 'headline-meta';
    meta.textContent = `${formatDateAEST(item.date)}${item.author ? ' — ' + item.author : ''}`;
    content.appendChild(link);
    content.appendChild(meta);
    wrapper.appendChild(img);
    wrapper.appendChild(content);
    const desc = document.createElement('div');
    desc.className = 'headline-description';
    desc.textContent = item.description || '';
    const container = document.createElement('div');
    container.appendChild(wrapper);
    container.appendChild(desc);
    return container;
  }
  col1.innerHTML = '';
  col1Headlines.forEach(item => col1.appendChild(createHeadlineItem(item)));
  col2.innerHTML = '';
  col2Headlines.forEach(item => col2.appendChild(createHeadlineItem(item)));
  col3.innerHTML = '';
  col3Headlines.forEach(item => col3.appendChild(createHeadlineItem(item)));

  const archiveLinkWrapper = document.createElement('div');
  archiveLinkWrapper.style.textAlign = 'center';
  archiveLinkWrapper.style.marginTop = '20px';
  const archiveLink = document.createElement('a');
  archiveLink.href = '/archive';
  archiveLink.textContent = 'View All Archived Headlines...';
  archiveLink.style.color = 'white';
  archiveLink.style.fontSize = '18px';
  archiveLink.addEventListener('mouseover', () => archiveLink.style.color = 'gold');
  archiveLink.addEventListener('mouseout', () => archiveLink.style.color = 'white');
  archiveLinkWrapper.appendChild(archiveLink);
  col3.appendChild(archiveLinkWrapper);
})
.catch(e => console.error('Fetch error loading headlines:', e));
</script>

<script>
// Scroll behavior to show/hide sun icon
window.addEventListener("scroll", () => {
  const sun = document.querySelector(".sun-link");
  const time = document.querySelector(".header-time");
  if (window.scrollY > 50) {
    sun.style.display = "inline-flex";
    if (window.innerWidth <= 768) {
      time.style.display = "none";
    }
  } else {
    sun.style.display = "none";
    if (window.innerWidth <= 768) {
      time.style.display = "";
    }
  }
});
</script>

<script>
// Search toggle
document.getElementById("search-toggle").addEventListener("click", function() {
  const form = document.getElementById("search-form");
  form.classList.toggle("active");
  if (form.classList.contains("active")) {
    setTimeout(() => {
      document.getElementById("search-input").focus();
    }, 300);
  }
});
</script>

<script>
// Netlify Identity
if (window.netlifyIdentity) {
  window.netlifyIdentity.on("init", user => {
    if (!user) {
      window.netlifyIdentity.on("login", () => {
        document.location.href = "/admin/";
      });
    }
  });
  window.netlifyIdentity.init();
}
</script>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
const supabaseUrl = 'https://fpsykizmderxiwovqcwk.supabase.co';
const supabaseKey = 'YOUR_KEY_HERE';
const { createClient } = supabase;
const supabaseClient = createClient(supabaseUrl, supabaseKey);
</script>

<script>
// Poll fetch and submission
fetch('/data/poll.json?' + new Date().getTime())
  .then(r => r.json())
  .then(poll => {
    const container = document.getElementById('poll-container');
    if (!container || !poll || !poll.question || !poll.options) return;
    let html = `<form id="poll-form"><h3 class="poll-title">${poll.question}</h3>`;
    poll.options.forEach(opt => {
      html += `<label><input type="radio" name="pollOption" value="${opt}"> ${opt}</label>`;
    });
    html += `
      <div style="display:flex;gap:8px;flex-wrap:wrap;justify-content:center;margin-top:12px;">
        <button type="submit" class="button-flag">Vote</button>
        <button type="button" id="show-results-button" class="button-flag">Show Results</button>
      </div>
    </form>`;
    container.innerHTML = html;
    const form = document.getElementById('poll-form');
    form.addEventListener('submit', async function(e) {
      e.preventDefault();
      const selected = form.elements['pollOption'].value;
      const { error } = await supabaseClient.from('poll_votes').insert([{ option: selected }]);
      if (error) {
        container.innerHTML = `<p style="color:red;">Error: ${error.message}</p>`;
      } else {
        loadVoteCounts(selected);
      }
    });
    document.getElementById('show-results-button').addEventListener('click', () => {
      loadVoteCounts();
    });
  })
  .catch(e => console.error('Poll error:', e));

async function loadVoteCounts(votedOption) {
  const container = document.getElementById('poll-container');
  container.innerHTML = `<p class="poll-thank-you">Thank you${votedOption ? ' for voting for <b>' + votedOption + '</b>' : ''}!</p><p>Loading results...</p>`;
  const { data, error } = await supabaseClient.from('poll_votes').select('option');
  if (error) {
    container.innerHTML = `<p style="color:red;">Error loading results: ${error.message}</p>`;
    return;
  }
  const counts = {};
  data.forEach(row => counts[row.option] = (counts[row.option] || 0) + 1);
  const total = Object.values(counts).reduce((a,b)=>a+b,0);
  let html = '<h3>Vote Results</h3><div>';
  Object.entries(counts).forEach(([opt,count])=>{
    const pct = ((count/total)*100).toFixed(1);
    html+=`<div style="margin-bottom:8px;">
      <div>${opt}: ${count} vote${count!==1?'s':''} (${pct}%)</div>
      <div style="background:#555;width:100%;height:14px;border-radius:4px;overflow:hidden;">
        <div style="background:gold;width:${pct}%;height:100%;"></div>
      </div>
    </div>`;
  });
  html+='</div>';
  container.innerHTML = html;
}
</script>
</body>
</html>
